!function(){"use strict";if(void 0!==window.DS){var e=Ember.Namespace.create({VERSION:"1.1.1"});Ember.libraries&&Ember.libraries.registerCoreLibrary("EmberFire",e.VERSION);var r=Ember.RSVP.Promise,n=Ember.EnumerableUtils.map,t=Ember.EnumerableUtils.forEach,i=Ember.String.fmt;DS.FirebaseSerializer=DS.JSONSerializer.extend(Ember.Evented,{normalize:function(e,r){return e.eachRelationship(function(n,t){if("hasMany"===t.kind)if("object"!=typeof r[n]||Ember.isArray(r[n])||t.options.embedded===!0){if(Ember.isArray(r[n]))throw new Error(i('%@ relationship %@(\'%@\') must be a key/value map in Firebase. Example: { "%@": { "%@_id": true } }',[e.toString(),t.kind,t.type.typeKey,t.key,t.type.typeKey]))}else r[n]=Ember.keys(r[n])}),this._super.apply(this,arguments)},extractSingle:function(e,r,n){var t=(e.adapterFor(r),this.normalize(r,n));return r.eachRelationship(function(a,o){if(!Ember.isNone(n)&&!Ember.isNone(n[a])&&o.options.embedded===!0){var u,s,d=t[a],l=[];if("belongsTo"===o.kind){if("string"!=typeof d.id)throw new Error(i('Embedded relationship "%@" of "%@" must contain an "id" property in the payload',[o.type.typeKey,r]));l.push(d),t[a]=d.id}else{for(u in d)s=d[u],null!==s&&"object"==typeof s&&(s.id=u),l.push(s);t[a]=Ember.keys(t[a])}e.pushMany(o.type,l)}}),t},extractArray:function(e,r,t){return n(t,function(n){return this.extractSingle(e,r,n)},this)},serializeHasMany:function(e,r,n){var t=n.key,i=this.keyForRelationship?this.keyForRelationship(t,"hasMany"):t,a=DS.RelationshipChange.determineRelationshipType(e.constructor,n),o=["manyToNone","manyToMany","manyToOne"];o.indexOf(a)>-1&&(r[i]=Ember.A(e.get(t)).mapBy("id"))}}),DS.FirebaseAdapter=DS.Adapter.extend(Ember.Evented,{defaultSerializer:"-firebase",init:function(){if(!this.firebase||"object"!=typeof this.firebase)throw new Error("Please set the `firebase` property on the adapter.");this._ref=this.firebase.ref(),this._findAllMapForType={},this._recordCacheForType={},this._queue=[]},generateIdForRecord:function(){return this._ref.push().name()},_assignIdToPayload:function(e){var r=e.val();return null!==r&&"object"==typeof r&&"undefined"==typeof r.id&&(r.id=e.name()),r},find:function(e,n,t){var a=this,o=!1,u=this._getRef(n,t),s=e.serializerFor(n);return new r(function(r,d){u.on("value",function(l){var c=a._assignIdToPayload(l),f=e.getById(n,l.name());if(a._updateRecordCacheForType(n,c),o)null===c&&f&&!f.get("isDeleted")?a._enqueue(function(){e.getById(n,l.name()).deleteRecord()}):null!==c&&a._enqueue(function(){e.push(n,s.extractSingle(e,n,c))});else if(o=!0,null===c){e.hasRecordForId(n,t)&&e.dematerializeRecord(f);var h=new Error(i("no record was found at %@",[u.toString()]));h.recordId=t,a._enqueue(d,[h])}else a._enqueue(r,[c])},function(e){o||a._enqueue(d,[e])})},i("DS: FirebaseAdapter#find %@ to %@",[n,u.toString()]))},findMany:function(e,r,i){var a=n(i,function(n){return this.find(e,r,n)},this);return Ember.RSVP.allSettled(a).then(function(n){return n=Ember.A(n),t(n.filterBy("state","rejected"),function(n){var t=n.reason.recordId;if(e.hasRecordForId(r,t)){var i=e.getById(r,t);e.dematerializeRecord(i)}}),Ember.A(n.filterBy("state","fulfilled")).mapBy("value")})},findAll:function(e,n){var t=this,a=this._getRef(n);return new r(function(r,i){var o;t._findAllHasEventsForType(n)||(o=t._findAllAddEventListeners(e,n,a)),a.once("value",function(e){var i=[];o&&Ember.run(null,o.resolve),null===e.val()?t._enqueue(r,[i]):(e.forEach(function(e){var r=t._assignIdToPayload(e);t._updateRecordCacheForType(n,r),i.push(r)}),t._enqueue(r,[i]))},function(e){t._enqueue(i,[e])})},i("DS: FirebaseAdapter#findAll %@ to %@",[n,a.toString()]))},_findAllMapForType:void 0,_findAllHasEventsForType:function(e){return!Ember.isNone(this._findAllMapForType[e])},_findAllAddEventListeners:function(e,r,n){this._findAllMapForType[r]=!0;var t=Ember.RSVP.defer(),i=this,a=e.serializerFor(r),o=!1;return t.promise.then(function(){o=!0}),n.on("child_added",function(n){o&&i._handleChildValue(e,r,a,n)}),n.on("child_changed",function(n){o&&i._handleChildValue(e,r,a,n)}),n.on("child_removed",function(n){if(o){var t=e.getById(r,n.name());t&&!t.get("isDeleted")&&i._enqueue(function(){e.deleteRecord(t)})}}),t},_handleChildValue:function(e,r,n,t){var i=this._assignIdToPayload(t);this._enqueue(function(){e.push(r,n.extractSingle(e,r,i))})},createRecord:function(e,r,n){return this.updateRecord(e,r,n)},updateRecord:function(e,n,t){var a=this,o=this._getRef(n,t.id),u=Ember.get(a._recordCacheForType,i("%@.%@",[n.typeKey,t.get("id")]))||{};return this._getSerializedRecord(t).then(function(s){return new r(function(r,d){var l=Ember.A();t.eachRelationship(function(r,t){var i;switch(t.kind){case"hasMany":Ember.isArray(s[r])&&(i=a._saveHasManyRelationship(e,n,t,s[r],o,u),l.push(i),delete s[r]);break;case"belongsTo":"undefined"==typeof s[r]||null===s[r]||""===s[r]?delete s[r]:t.options.embedded===!0&&(i=a._saveBelongsToRecord(e,n,t,s[r],o),l.push(i),delete s[r])}}),Ember.RSVP.allSettled(l).then(function(e){e=Ember.A(e);var u=Ember.A(e.filterBy("state","rejected"));if(0!==u.get("length")){var l=new Error(i("Some errors were encountered while saving %@ %@",[n,t.id]));l.errors=u.mapBy("reason"),a._enqueue(d,[l])}o.update(s,function(e){e?a._enqueue(d,[e]):a._enqueue(r)})})})},i("DS: FirebaseAdapter#updateRecord %@ to %@",[n,o.toString()]))},_getSerializedRecord:function(e){var n=e.serialize({includeId:!1}),t=[];return e.eachRelationship(function(i,a){switch(a.kind){case"hasMany":t.push(r.cast(e.get(i)).then(function(e){n[i]=Ember.A(e).mapBy("id")}))}}),Ember.RSVP.all(t).then(function(){return n})},_saveHasManyRelationship:function(e,r,n,t,a,o){if(!Ember.isArray(t))throw new Error("hasMany relationships must must be an array");var u=this,s=Ember.A(o[n.key]);t=Ember.A(t);var d=t.filter(function(e){return!s.contains(e)}),l=t.filter(function(r){var t=n.type;return e.hasRecordForId(t,r)&&e.getById(t,r).get("isDirty")===!0});l=Ember.A(l.concat(d)).uniq().map(function(r){return u._saveHasManyRecord(e,n,a,r)});var c=s.filter(function(e){return!t.contains(e)});c=Ember.A(c).map(function(r){return u._removeHasManyRecord(e,n,a,r)});var f=l.concat(c);return Ember.RSVP.allSettled(f).then(function(e){var r=Ember.A(Ember.A(e).filterBy("state","rejected"));if(0===r.get("length"))return o[n.key]=t,e;var a=new Error(i("Some errors were encountered while saving a hasMany relationship %@ -> %@",[n.parentType,n.type]));throw a.errors=Ember.A(r).mapBy("reason"),a})},_saveHasManyRecord:function(e,n,t,i){var a=this,o=this._getRelationshipRef(t,n.key,i),u=e.getById(n.type,i),s=n.options.embedded===!0,d=s?u.serialize({includeId:!1}):!0;return new r(function(e,r){var n=function(n){n?("object"==typeof n&&(n.location=o.toString()),a._enqueue(r,[n])):a._enqueue(e)};s?o.update(d,n):o.set(d,n)})},_removeHasManyRecord:function(e,n,t,i){var a=this,o=this._getRelationshipRef(t,n.key,i);return new r(function(e,r){var n=function(n){n?("object"==typeof n&&(n.location=o.toString()),a._enqueue(r,[n])):a._enqueue(e)};o.remove(n)})},_saveBelongsToRecord:function(e,n,t,i,a){var o=this,u=a.child(t.key),s=e.getById(t.type,i),d=t.options.embedded===!0,l=d?s.serialize({includeId:!0}):!0;return new r(function(e,r){var n=function(n){n?("object"==typeof n&&(n.location=u.toString()),o._enqueue(r,[n])):o._enqueue(e)};d?u.update(l,n):u.set(l,n)})},deleteRecord:function(e,n,t){var a=this,o=this._getRef(n,t.get("id"));return new r(function(e,r){o.remove(function(n){n?a._enqueue(r,[n]):a._enqueue(e)})},i("DS: FirebaseAdapter#deleteRecord %@ to %@",[n,o.toString()]))},pathForType:function(e){var r=Ember.String.camelize(e);return Ember.String.pluralize(r)},_getRef:function(e,r){var n=this._ref;return e&&(n=n.child(this.pathForType(e.typeKey))),r&&(n=n.child(r)),n},_getRelationshipRef:function(e,r,n){return e.child(r).child(n)},_queueFlushDelay:1e3/60,_queueScheduleFlush:function(){Ember.run.later(this,this._queueFlush,this._queueFlushDelay)},_queueFlush:function(){t(this._queue,function(e){var r=e[0],n=e[1];r.apply(null,n)}),this._queue.length=0},_enqueue:function(e,r){var n=this._queue.push([e,r]);1===n&&this._queueScheduleFlush()},_recordCacheForType:void 0,_updateRecordCacheForType:function(e,r){if(r){var n=this,t=r.id,i=n._recordCacheForType,a=e.typeKey;e.eachRelationship(function(e,n){if("hasMany"===n.kind){var o=r[e];i[a]=i[a]||{},i[a][t]=i[a][t]||{},i[a][t][e]=Ember.isNone(o)?Ember.A():Ember.A(Ember.keys(o))}})}}}),Ember.onLoad("Ember.Application",function(e){e.initializer({name:"firebase",initialize:function(e,r){r.register("adapter:-firebase",DS.FirebaseAdapter),r.register("serializer:-firebase",DS.FirebaseSerializer)}})})}}();